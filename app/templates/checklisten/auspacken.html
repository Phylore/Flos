<!DOCTYPE html>
<html>
<head>
    <title>üì¶ Auspacken ‚Äì {{ geraet.qrcode }}</title>
</head>
<body>
    <h1>üì¶ Auspacken: {{ geraet.modell.name }} ({{ geraet.qrcode }})</h1>

    <!-- üêû DEBUG: Zust√§nde -->
    <h3 style="color: teal;">DEBUG: ZUST√ÑNDE</h3>
    <ul>
        {% for z in zustaende %}
            <li>{{ z.id }} ‚Äì {{ z.value }}</li>
        {% else %}
            <li><strong>‚ùå KEINE ZUST√ÑNDE GELADEN</strong></li>
        {% endfor %}
    </ul>

    <!-- üêû DEBUG: Module -->
    <h3 style="color: teal;">DEBUG: MODULE</h3>
    <ul>
        {% for modul in geraet.module %}
            <li>{{ modul.name }} ({{ modul.id }}) ‚Äì {{ modul.teile|length }} Teile</li>
        {% else %}
            <li><strong>‚ùå KEINE MODULE VORHANDEN</strong></li>
        {% endfor %}
    </ul>

    <form method="post">
        {% for modul in geraet.module %}
            <h2>{{ modul.name }}</h2>

            <table border="1">
                <thead>
                    <tr>
                        <th>Teil</th>
                        <th>Anwesenheit</th>
                        <th>DEBUG</th>
                    </tr>
                </thead>
                <tbody>
                {% for teil in modul.teile %}
                    <tr>
                        <td>{{ teil.name }}</td>
                        <td>
                            <select name="anwesenheit_{{ teil.id }}">
                                {% for z in zustaende %}
                                    {% set ist_selected = (teil.anwesenheit_id == z.id)
                                                           or (teil.anwesenheit_id is none and z.value == "Nicht gepr√ºft") %}
                                    <option value="{{ z.id }}" {% if ist_selected %}selected{% endif %}>
                                        {{ z.value }}
                                    </option>
                                {% endfor %}
                            </select>
                        </td>
                        <td style="font-family: monospace; font-size: 0.9em;">
                            ID: {{ teil.anwesenheit_id }}<br>
                            {% for z in zustaende %}
                                {% set ist_selected = (teil.anwesenheit_id == z.id)
                                                       or (teil.anwesenheit_id is none and z.value == "Nicht gepr√ºft") %}
                                {% if ist_selected %}
                                    ‚Üí selected: {{ z.value }} (ID {{ z.id }})
                                {% endif %}
                            {% endfor %}
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endfor %}

        <br>
        <button type="submit">üíæ Anwesenheiten speichern</button>
    </form>

    <br>
    <a href="{{ url_for('geraete.geraet_seite', qrcode=geraet.qrcode) }}">üîô Zur√ºck zum Ger√§t</a>
</body>
</html>

