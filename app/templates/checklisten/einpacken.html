<!DOCTYPE html>
<html>
<head>
    <title>📦 Einpacken – {{ geraet.qrcode }}</title>
</head>
<body>
    <h1>📦 Einpacken: {{ geraet.modell.name }} ({{ geraet.qrcode }})</h1>

    <h2>✅ Vorbereitungs-Check</h2>
    <ul>
        <li>📦 Auspacken: 
            {% if geraet.ausgepackt %}✅{% else %}❌{% endif %}
        </li>
        <li>🧽 Reinigung: 
            {% if geraet.gereinigt %}✅{% else %}❌{% endif %}
        </li>
        <li>🧪 Funktionstest: 
            {% if geraet.getestet %}✅{% else %}❌{% endif %}
        </li>
        <li>📸 Bilder: 
            {% if geraet.bilder_einpackfertig %}✅{% else %}❌{% endif %}
        </li>
    </ul>

    <h2>📦 Ersatzteilpaket auswählen</h2>

    <form method="post">
        <label for="ersatzpaket">Paket:</label>
        <select name="ersatzpaket" id="ersatzpaket" required>
            <option value="" disabled selected>-- Wähle ein Paket --</option>
            {% for paket in ersatzpakete %}
                <option value="{{ paket }}">{{ paket }}</option>
            {% else %}
                <option disabled>❌ Keine Pakete verfügbar</option>
            {% endfor %}
        </select>

        <h3>📋 Enthaltene Teile:</h3>
        <ul id="teilListe">
            <li><em>Bitte ein Paket auswählen</em></li>
        </ul>

        <br><br>
        <button type="submit">📦 Einpacken abschließen</button>
    </form>

    <br>
    <a href="{{ url_for('geraete.geraet_seite', qrcode=geraet.qrcode) }}">🔙 Zurück zum Gerät</a>

    <script>
        const ersatzteile = {{ ersatzpaket_inhalt_json | safe }};

        document.getElementById("ersatzpaket").addEventListener("change", function () {
            const selected = this.value;
            const teile = ersatzteile[selected] || [];

            const liste = document.getElementById("teilListe");
            liste.innerHTML = "";

            if (teile.length === 0) {
                liste.innerHTML = "<li><em>Keine Teile definiert</em></li>";
            } else {
                teile.forEach(name => {
                    const li = document.createElement("li");
                    li.textContent = name;
                    liste.appendChild(li);
                });
            }
        });
    </script>
</body>
</html>

